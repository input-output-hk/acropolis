use crate::{utils::to_hash, witness::map_native_script};
use acropolis_common::*;
use pallas_primitives::conway;
use pallas_traverse::{MultiEraPolicyAssets, MultiEraValue};

pub fn map_value(pallas_value: &MultiEraValue) -> Value {
    let lovelace = pallas_value.coin();
    let pallas_assets = pallas_value.assets();

    let mut assets: NativeAssets = Vec::new();

    for policy_group in pallas_assets {
        match policy_group {
            MultiEraPolicyAssets::AlonzoCompatibleOutput(policy, kvps) => {
                match policy.as_ref().try_into() {
                    Ok(policy_id) => {
                        let native_assets = kvps
                            .iter()
                            .filter_map(|(name, amt)| {
                                AssetName::new(name).map(|asset_name| NativeAsset {
                                    name: asset_name,
                                    amount: *amt,
                                })
                            })
                            .collect::<Vec<_>>();

                        assets.push((policy_id, native_assets));
                    }
                    Err(_) => {
                        tracing::error!(
                            "Invalid policy id length: expected 28 bytes, got {}",
                            policy.len()
                        );
                        continue;
                    }
                }
            }
            MultiEraPolicyAssets::ConwayOutput(policy, kvps) => match policy.as_ref().try_into() {
                Ok(policy_id) => {
                    let native_assets = kvps
                        .iter()
                        .filter_map(|(name, amt)| {
                            AssetName::new(name).map(|asset_name| NativeAsset {
                                name: asset_name,
                                amount: u64::from(*amt),
                            })
                        })
                        .collect();

                    assets.push((policy_id, native_assets));
                }
                Err(_) => {
                    tracing::error!(
                        "Invalid policy id length: expected 28 bytes, got {}",
                        policy.len()
                    );
                    continue;
                }
            },
            _ => {}
        }
    }
    Value::new(lovelace, assets)
}

pub fn map_datum(datum: &Option<conway::MintedDatumOption>) -> Option<Datum> {
    match datum {
        Some(conway::MintedDatumOption::Hash(h)) => Some(Datum::Hash(h.to_vec())),
        Some(conway::MintedDatumOption::Data(d)) => Some(Datum::Inline(d.raw_cbor().to_vec())),
        None => None,
    }
}

pub fn map_reference_script(script: &Option<conway::MintedScriptRef>) -> Option<ReferenceScript> {
    match script {
        Some(conway::PseudoScript::NativeScript(script)) => {
            Some(ReferenceScript::Native(map_native_script(script)))
        }
        Some(conway::PseudoScript::PlutusV1Script(script)) => {
            Some(ReferenceScript::PlutusV1(script.as_ref().to_vec()))
        }
        Some(conway::PseudoScript::PlutusV2Script(script)) => {
            Some(ReferenceScript::PlutusV2(script.as_ref().to_vec()))
        }
        Some(conway::PseudoScript::PlutusV3Script(script)) => {
            Some(ReferenceScript::PlutusV3(script.as_ref().to_vec()))
        }
        None => None,
    }
}

pub fn map_reference_script_hash(script: &Option<conway::MintedScriptRef>) -> Option<ScriptHash> {
    let script = map_reference_script(script);
    script.and_then(|s| s.compute_hash())
}

pub fn map_mint_burn(
    policy_group: &MultiEraPolicyAssets<'_>,
) -> Option<(PolicyId, Vec<NativeAssetDelta>)> {
    match policy_group {
        MultiEraPolicyAssets::AlonzoCompatibleMint(policy, kvps) => {
            let policy_id: PolicyId = to_hash(*policy);

            let deltas = kvps
                .iter()
                .filter_map(|(name, amt)| {
                    AssetName::new(name).map(|asset_name| NativeAssetDelta {
                        name: asset_name,
                        amount: *amt,
                    })
                })
                .collect::<Vec<_>>();

            Some((policy_id, deltas))
        }

        MultiEraPolicyAssets::ConwayMint(policy, kvps) => {
            let policy_id: PolicyId = to_hash(*policy);

            let deltas = kvps
                .iter()
                .filter_map(|(name, amt)| {
                    AssetName::new(name).map(|asset_name| NativeAssetDelta {
                        name: asset_name,
                        amount: i64::from(*amt),
                    })
                })
                .collect::<Vec<_>>();
            Some((policy_id, deltas))
        }

        _ => None,
    }
}

#[cfg(test)]
mod tests {
    use acropolis_common::{ReferenceScript, ScriptHash};
    use hex::FromHex;
    use std::str::FromStr;

    #[test]
    fn test_reference_script_hash() {
        let expected_hash =
            ScriptHash::from_str("befbcb19919ff8ce5323d123c835da8e7653a098ad482271a72b72f2")
                .expect("from_str must succeed");
        let script_bytes = "592066010100332229800aba2aba1aba0aab9faab9eaab9dab9a9bae0039bae002488888888966003300130053754015237906ecc0066e1d20009b80480066e252000911919800800801912cc004006297ae0899912cc004c01400a26601a0046600800800313300400400140246018002601a0028052460126014003374a90014dd2a400123009300a300a300a300a0019b874800a4601260146014003371090004dc3a40093700900124444444444444453001301800f980b807c8896600260200031301a0028cc00400e6036005300f001400c80aa44446601c0084b30013375e603860326ea8c070c064dd50008024528c56600266ebcc070c064dd5180e180c9baa001300d3301b375200497ae0899baf300e30193754603860326ea8004c030cc06cc030cc06c00d2f5c097ae08a50405c80ba44646600200200644b30010018a60103d87a8000899192cc004cdc8802800c56600266e3c0140062601a66038603400497ae08a60103d87a80004061133004004301e00340606eb8c060004c06c0050192444453001301c005980e180e802cc00c00e44464b3001300e301c375400314800226eb4c080c074dd5000a03632598009807180e1baa0018a60103d87a8000899198008009bab3021301e375400444b30010018a6103d87a8000899192cc004cdc8803000c56600266e3c0180062602866046604200497ae08a60103d87a8000407d1330040043025003407c6eb8c07c004c08800502020363300400300291192cc004c034c06cdd5000c52f5bded8c113756603e60386ea800501a19801801000a444453001301d37540092259800980b800c4cc0140080062c80f2444b3001301098009bab301630213754602c60426ea800e005001401513259800980818109baa001898111baa302530223754003164080602260426ea8c058c084dd5001c5901f2444b3001301a0038992cc004c06cc084dd5004c4c8cc8966002605200313259800980f98129baa0018991919912cc004c0b800e2664530013002002cc004dd6180e18161baa01798101981719806800a402097ae09810198171ba900b4bd704dd719806800a400080aa604c604260586ea804d22259800acc004c0a0c0b8dd519199119801001000912cc004006298103d87a80008992cc004cdd7981b18199baa001004898131981a800a5eb82266006006606e0048188c0d40050331bac3033303037540366048605e6ea805a2946294102d44ca6002003480026466002002660286eacc08cc0c4dd500e008112cc004006297adef6c60899912cc004c08cdd6981a00144cc0d8008cc0100100062660080080028190c0d4004c0d8005033200222259800800c528c4c8c966003300100598108024c0e000d00544c966002604c6eb4c0d400e2b30015980099b873371c0049000002c4cdc7cc005200298169b8d0028012e3000f14a0819a2b3001302630093301837566054606a6ea80040522604d300137566054606a6ea8006029002406514a0819a294103345282066330150070048b2064375c6064002606a002819a294102d0896600200314800226032660040046060002816a6002660166eb0c07cc0a8dd500a9bad302d302a375402302781320148b2056375a60560026eb8c0ac008c0ac004c098dd5000c590241814000c590261bad30260013027001302237540131640806eb8c090c084dd5003c566002601e0071329800912cc004c074c08cdd500144c8c8c9660026056005133006302a003132598009810800c4c966002605a00313232598009812000c4c966002606000313300b302f0010098b205a302b3754005159800980e000c4c8c8ca60026eb4c0c40066eb4c0c400e6eb4c0c400922259800981a802403a2c81906062002606000260566ea800a2c814902918149baa001302c0018b205430283754005159800980c800c56600260506ea800a00b1640a51640988130c098dd5000c590281814800981480098121baa0028b2044911919800800801911980180098010014c094c088dd50042444b3001301e302437540191323322598009816000c4cc014dd61815800912cc00400a2b3001301b3029375400d13298009bae3300c001480026eb8cc03000520149bae3300c001480326eb8cc03000520089bae3300c0014802a6eb8c0b8c0acdd5003a444444653001001a400133223302a00225980099baf3038303537546070606a6ea8c0a8c0d4dd50008014528c56600266ebcc0e0c0d4dd5181c181a9baa302a3035375400260526606e6ea40292f5c113375e6054606a6ea8c0e0c0d4dd51815181a9baa0013028330373028330370114bd7025eb82294103320663758606a60646ea8074c098cc0d0cc04c02120104bd70200222259800800c528c4c96600330010049811001cc0e400900444c9660026048606a6ea800626644b30013031303737540051323232323232323232329800992cc004c10c0062b30013371290021821000c5a260686084002820a2c8220dd51822800cdd718228054c114026608a00f30450069bae30450059bac30450049bac30450039bac3045002488888888966002609e0151332259800982318261baa002899191919191919191919194c004c96600260b200315980099b8948010c1600062d1304a3058001415d1641686ea8c16c00660b6015375a60b6013375a60b6011375a60b600f375a60b600d305b005982d8024dd6982d801cdd6982d80124444444444b3001306600b899815983280a899815804899912cc004c1740062b30013064375400d0028b20ca8acc004c1540062b30013064375400d0028b20ca8acc004c14800626464653001375a60d4003375a60d4007375a60d40049112cc004c1b80120111641ac306a00130690013064375400d16418883110620992cc004c17000626464b3001306900280cc590661bad306700130633754009159800982a000c56600260c66ea801202f1641911598009828800c4c8c8cc896600260d600701b8b20d0375a60d00026eb4c1a0008c1a0004c18cdd500245906120c2418460c26ea800cc184dd50024590630c16c004c168004c164004c160004c15c004c158004c154004c150004c14c004c148004c134dd500145904b182700889919912cc004c11c00626464b300130540028024590511bae3052001304e3754013159800981f800c4c8c96600260a80050048b20a2375c60a4002609c6ea80262b3001303c001899192cc004c15000a0091641446eb8c148004c138dd5004c56600260060031323259800982a00140122c8288dd7182900098271baa0098b20984130826104c099815003099814802112cc00400a26605600a44b3001002899816803112cc00400a33001330333758608e60a46ea80e4082460ac60ae60ae60ae003230563057305730573057305730570019182b182b982b982b982b982b982b982b982b800a4444b3001304f30553754009198009bae3059305637540093756609660ac6ea8c12cc158dd50114c00cc158dd50102444b3001304a980080140a600681ea2b30013370f30013756609660b26ea811205300340f49000c4c8c96600260a8003132323233001001375860c260c400644b30010018a508acc004cdc79bae30620010038a518998010011831800a0ba41806eb8c17c004c16cdd500145660026098003132323233001001375860c260c400644b30010018a508acc004cdd79831182f9baa3062305f375460c460c660be6ea8c18800400e294626600400460c600282e906018281982f182f800a5eb80c16cdd500145660026092003132323233001001375660c260c400644b30010018a508acc004cdd7801982f1831000c528c4cc008008c18c00505d20c030503305e305f0014bd70182d9baa0028994c004c154dd6982e182f9981f9bab305f3060001375c60be0034a14a282d0c16cdd500120b2416482c8c164dd5000992cc004c14c0062609a660b860ba60b46ea8008cc170c014c168dd5022a5eb822b3001304b001898271982e182e982d1baa0023305c305d305a375408a97ae08acc004c120006266e9520043305c305d305a3754004660b8600c60b46ea81152f5c113374a90031982e182e982d1baa0023305c304c305a375408a97ae0416082c1058182c1baa0018a50415d14a082b919800982b1baa004912cc004c144c15cdd500144c8ca60026eb4c17400660bc003375a60ba0049112cc004c18400a26604c60c000400d164178305d00130583754005164159223322304d3305c375066e08dd6982e8011bad305d0013305c375066e08dd6982e982f0011bad305d305e0014bd70182c1baa00230583754003222329800800c01200680088896600200510018994c00401260c200798009bae305c0019bad305d001801200a401060be00482ea6e0520009112cc004c14800626eb4c17000a33001003982e8014c14400500320ae9182d182d982d982d982d982d982d982d982d982d982d800c8c168c16cc16cc16cc16cc16c0064646644b300130493370a004003130473370800400313370800400282c0dd6982d8009bad305b305c001305737540032304a330593750002660b29810101004bd7048896600260a40031305c0028cc00400e60ba0053051001400c82ba4646600200200444b30010018a5eb82264664466446600400400244b30010018801c4c8cc184dd3998309ba900533061305e00133061305f0014bd701980180198318011830800a0be375660b80066eb8c164004cc00c00cc178008c17000505a489660020031480022608a6600400460b800282ca460b460b660b660b660b660b660b660b60032305a305b305b305b305b305b305b305b305b305b001488888888888888a600260d201f306800f91192cc004c164c19cdd5000c5300103d87a80008982d9983519808001983598341baa0014bd7020cc3233225980099b8800248002260ba660d860ba660d86ea0c040004cc1b0dd4180800125eb812f5c1159800982c80144c174cc1b0c174cc1b0dd4000998361ba80024bd7025eb82298103d87a800041a08340dd698358009bad306b306c0013067375400322598009830000c5300103d87a80008acc004cdc4000a40011305a33069305a330693750601a004660d26ea0c0340052f5c097ae08982d19834982d198349ba800233069375000297ae04bd7020ca4195300a00a9801801c8888888896600266e3c0092201008a6116d8799fd8799fd8799f0000d8799f4040ffff0101ffff008992cc004c1a0c1b8dd5000c4c96600260d260de6ea80062646464b3001307700289919912cc004c1bc00a26464646644b3001307f003899812183f00280345907c1bad307c001375a60f800460f800260f600260ec6ea800e2b300130670028991919194c004dd6983e800cdd6983e801cdd6983e8012444b300130810100489981318400080380445907e0c1f4004c1f0004c1ec004c1d8dd5001c56600260c80051323232332259800983f801c4cc090c1f801401a2c83e0dd6983e0009bad307c002307c001307b00130763754007159800981580144c8c8c8ca60026eb4c1f40066eb4c1f40126eb4c1f40092225980098408080244cc098c200040180222c83f060fa00260f800260f600260ec6ea800e2b30013370e900400144c8c8c8c8ca60026eb4c1f80066eb4c1f80166eb4c1f80126eb4c1f8009222259800984180802c4cc0a0c2080401c02a2c84000860fc00260fa00260f800260f600260ec6ea800e2c83a107420e841d083a0c1ccdd5000899828801112cc00400a264b30015980099b89337026eb4c1b0c1dcdd50009bad307a3077375400290405d5b81c56600266e24038dd69836183b9baa0018acc004cdc49bad307a3077375400201f159800992cc004c1c4c1dcdd5005c56600266e3cdd7183d983c1baa00100c899b8f375c60da60f06ea8004dd7183d983c1baa00b8a5041d913371e6eb8c1ecc1e0dd500080620ec306730773754003130669800808c03601882da2941075452820ea8a5041d514a083aa260d4660f260f460ee6ea80212f5c114c103d87a800041d46464b300130690018983d983c1baa0028acc004c1c4006260f660f06ea800a2b300130660018983d983c1baa0028acc004c0b4006260f660f860f06ea800a260f660f860f860f06ea800907620ec41d883b0c1d8dd5000983c983b1baa0078992cc004c1c0c1d8dd5000c4c8c8cc896600260fe00713006307f0078b20f8375a60f80026eb8c1f0008c1f0004c1dcdd5000c59075183c80120ee30760038b20e8375860ea00260ea00260e06ea80062c8370c1c8c1bcdd5000c5906d191919800800804912cc004006298103d87a80008992cc004cdd78021838800c4c194cc1d0c1c80052f5c1133003003307600241c060e80028390cdd2a4008660e001297ae041b13306730683065375460d060ca6ea8c008c194dd502819833983418329baa305a30653754600460ca6ea81412f5c0911111114c004c1c40226eb4c1c002244b30013066001899803001000c5906d488888888888c96600260ce60f06ea8006264b300159800992cc004c1b0c1e8dd5000c4cdc79bae307e307b375400201914a083c8c1f4c1e8dd5183e983d1baa00d899baf306f307a375460fa60f46ea8034c1bcc1e8dd50024528a0f08acc0056600266ebcc1f4c1e8dd5001000c56600260d060f26ea8c078c1e8dd5000c6600266ebcc1a8c1e8dd5183e983f183f183f183f183f183f183f183f183f183f183f183f183f183f183f183f183d1baa0014c010ed8799f444e4f4e45444e4f4e45ff00a50a5141e114a283c22941078456600260d73001375660de60f46ea80360190064179159800992cc004c1d0c1e8dd5000c4cdc48044c004dd59838183d9baa00e9bae307e307b3754013375c60fc60f66ea800505f44cdc48044c004cc178dd59838183d9baa00e375c60fc60f66ea802690004888cdc0001000a04441e460de60f46ea8022266e1cc040c064dd59837983d1baa00d598009839983c9baa306f307a375401115980099b8f375c60fa60f46ea8021221008a400914801907844cdc04c004cc174dd59837983d1baa00d375c60fa60f46ea802290004888c1a80050212400883c22941078452820f08a5041e114a083c0c1b0cc1ed3010100003307b3750010660f66ea0010cc1ed3010100003307b30693079375460d260f26ea8024cc1ecc1acc1e4dd51834983c9baa0093307b307c3079375460d260f26ea8024cc1ecc1b8c1e4dd51834983c9baa0093307b30263079375460d260f26ea8024cc1ecc070c1e4dd51834983c9baa0093307b30253079375460d260f26ea8024cc1ecc058c1e4dd51834983c9baa0093307b30243079375460d260f26ea8024cc1ecc054c1e4dd51834983c9baa0093307b98009835183c1baa301d3079375460d260f26ea802698103d87a8000a60103d879800041dc660f66ea4cdc524504504f4f4c000023307b0074bd704590771834183c1baa00b9838000a44444646464653001375c60f2003375a60f260f4003375a60f2013375a60f2009375a60f2007375a60f20049111112cc004c1b4c1ecdd5005c4cc896600260de60fa6ea800633001375a61020260fc6ea800660f061020260fc6ea812a660bf3001375860dc60fc6ea81a660e466100026ea41492f5c13072330800137520a297ae0829a0ce04c9982f9bac302a307e375409000b337033001375660e660fc6ea8c1ccc1f8dd50254dd7184080983f1baa308101307e375460dc60fc6ea81226eb8c1ccc1f8dd5184080983f1baa306e307e3754090831000e6602c6601e6eb0c06cc1f8dd5024002998079bac3029307e375409000a9111112cc004c1f4c20c04dd5000c4c96600260e8015159800acc004cdc79bae308801308501375409e9101044e4f4e45008a518992cc004c1dcc21404dd5000c4cdc79bae30890130860137540a06eb8c22404c21804dd5000c5908401184200acc004c1f003a330010259bab303130850137540e100e409516420c0484180a2b3001307698009bab307a308501375460f4610a026ea81460ab00f41a5159800992cc004c1dcc21404dd5000c4c96600260f0610c026ea8006266e24cdc09bad308a0130870137540026eb4c22804c21c04dd500124101756e0716421404611202610c026ea8c1ecc21804dd518119843009baa0718b2108023088013085013754611002610a026ea8c088c21404dd50384566002b3001307630840137546042610a026ea813e2664464b3001308101308701375400313232598009841809844809baa0018cc00402a0bb05e82a403e013323322598009843009846009baa0028981799912cc004c2200400626464b3001308a013090013754003132598009845809848809baa0018984a809849009baa0018b2120023302a004309401309101375400316423c04660506eb4c24c04004dd6984980984a008009849809847809baa0038acc004c200040062d159800983e800c4c8c9660026114026120026ea8006264b3001308b0130910137540031309501309201375400316424004660540086128026122026ea80062c847808cc0a0dd69849808009bad309301309401001309301308f0137540071598009822000c4c8c9660026114026120026ea8006264b3001308b0130910137540031309501309201375400316424004660540086128026122026ea80062c847808cc0a0dd69849808009bad309301309401001309301309301308f01375400713232598009845009848009baa0018992cc004c22c04c24404dd5000c4c25404c24804dd5000c590900119815002184a009848809baa0018b211e0233028375a6126020026eb4c24c04c25004004c24c04c24c04c24c04c23c04dd5001a11a0242340484680908d011848009846809baa002308c01375400316422c04660486644b3001308601001899192cc004c22004c23804dd5000c4cc0dcc24804c23c04dd500080245908d01198131bad309101001375a612202612402002612202611a026ea800e2b3001307e0018b456600260f600313232598009844009847009baa00189981b9849009847809baa0010048b211a0233026375a6122020026eb4c24404c24804004c24404c23404dd5001c566002608400313232598009844009847009baa00189981b9849009847809baa0010048b211a0233026375a6122020026eb4c24404c24804004c24404c24404c23404dd5001c4c8c966002611002611c026ea800626606e612402611e026ea80040122c846808cc098dd69848808009bad309101309201001309101309101309101308d01375400684580908b01211602422c0460580206114026ea800401cc23804c22c04dd50021846809845009baa001805c0320490144069164220053001308c0130890137546118026112026ea8c1f8c22404dd5000cdd5983f1844809baa307e30890137540033756604a6112026ea81d201b00b9bae308c01308901375460fc6112026ea8c1e4c22404dd5029cdd7183f1844809baa307e308901375460f26112026ea814e6eb8c23004c22404dd51846009844809baa307930890137540a7307c3308b01307e30890137546118026112026ea8c1e4c22404dd5029a5eb8101e198349bac307d30880137540e6021164218053001308a013087013754611402610e026ea8c1f0c21c04dd50014dd5983e1843809baa307c308701375400537566046610e026ea81ca0170099bae308a013087013754003375c60f8610e026ea80066eb8c22804c21c04dd50034c1f0c21c04dd5003203833066375860f4610a026ea81c002cc1d4c21404dd500246600200b05882cc13e0150049813998169813005000c01a00f01f807a02a420c051598009919912cc004c1d8c21c04dd5001456600266ebcc22c04c22004dd5001983d1844009baa0528acc004cdc79b9437666116026110026ea8008dd718159844009baa0528acc004c1e6600200305a804a0d88acc004c1e660026eacc1f4c22004dd5001c1660128362266e24c078c09cdd5983e9844009baa0034802a2941086014528210c028a5042180514a084300a2c843008c1d8c21804dd50009bab307830860137540e2660cc6eb0c1d4c21404dd503800bc566002b3001307e003899b8798009bab307730850137540e1055807a0d2480062941083014528c56600260e80071323259800983a9843009baa0018acc004cdd79845009843809baa307c30870137540a6611402610e026ea800a2b30013375e611402610e026ea80041462b3001307898009bab307c3087013754005057808a0d68acc004cdc3cc004dd5983e1843809baa0029bae308a013087013754611402610e026ea8c1dcc21c04dd5028cdd7183e1843809baa308a01308701375460ee610e026ea814506b002c4cdc3980e98131bab307c3087013754004603a604c6eacc1f0c21c04dd5183e1843809baa0538a5042140514a084280a2941085014528210a028b210a0230763086013754002660cc6eb0c1d4c21404dd5038029c528210602420c0514a084180a29410830145282106028a50420c0514a084180a2941083011843809842009baa0018b21040245907c1bad307f307c375401660fe6100020211641e83079001307800130770013076005082a113230023057003375a60aa004829a264600460aa0066eb4c14c00905144c9660026090609c6ea800626464646644b3001305800389919912cc004c14000a26464b3001305d002801c5905a1bae305b001305737540071598009824001456600260ae6ea800e00316416116415482a8c150dd500089980f00189804182c804982b802459055182a8009bae305500330550013054001304f375400316413460a20048278c12cdd50039b874801a2c8260608a00260880026086002608400260820026080002607e002607c002607a00260706ea800a2c81b0c0e4c0d8dd5000912cc004c0c4c0dcdd500144c8c8cc896600260800070058b207a375c607a0026eb8c0f4008c0f4004c0e0dd50014590364590341812981a9baa302a303537540031640cc606e00281a930013300b3758603e60546ea8054dd6981698151baa011813c09900a45902844c8cc8966002604c00513232598009819801400e2c8180dd7181880098169baa0038acc004c07800a264646464646464653001375a6070003375a607000f375a607000d375a607000b375a6070009375a6070007375c607000491111112cc004c100022266034607e01e0211640f43038001303700130360013035001303400130330013032001302d37540071640ac8158c0a8dd5000898011817801981680120568b2052375a60520026054002604a6ea80322c81184464b3001301d001899192cc004c0a800a00916409c6eb8c0a0004c090dd5001c566002602a0031323259800981500140122c8138dd7181400098121baa0038b2044408860446ea800a2c80f901f0452689b2b20062611e581c219832152b2c489358f4c02a1818d312a851b1f55774ae881e33a907004c010b4a706172616d65746572730001";
        let ref_script =
            ReferenceScript::PlutusV3(Vec::from_hex(script_bytes).expect("from_hex must succeed"));
        let computed_hash = ref_script.compute_hash().unwrap();

        assert_eq!(computed_hash, expected_hash);
    }
}
